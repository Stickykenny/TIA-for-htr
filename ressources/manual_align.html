<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>TITLE</title>
    <link rel="stylesheet" href="manual_align.css">
</head>

<body>
    <div id="header"> TITLE</div>
    <div id="top" style="text-align:center;"><img id='crop'style="min-width:500px;max-width:1000px"
            src="GameOver.png"
            alt="Image not shown correctly, try changing browser"></div>
    <div id="bottom" fontsize="18px">

        SOURCE_TEXT

        <script defer>
            cropCount = 0;
            transcriptionCount = 0;
            const images= IMAGELIST
            const img = document.getElementById("crop");
            img.src  = images[cropCount];
            const clickableTexts = document.querySelectorAll('.click_text');
            var startedSelect = false;

            
            clickableTexts.forEach(text => {
                text.addEventListener('click', () => {
                    reset();
                    text.classList.add("startSelect");
                    startedSelect = true;
                    
                });
                text.addEventListener('contextmenu', () => {
                    text.classList.add("endSelect")
                    if (startedSelect) {
                        const startTag = document.getElementsByClassName('startSelect')[0];
                        const endTag = document.getElementsByClassName('endSelect')[0];

                        // Loop until we reach the endTag
                        let textContent = '';
                        let currentNode = startTag.nextSibling;
                        const div = document.createElement('div');
                        div.classList.add("used")
                        while (currentNode && (currentNode !== endTag)) {
                            div.append(currentNode)
                            textContent += currentNode.textContent;
                            currentNode = currentNode.nextSibling;
                        }
                        console.log(textContent)
                        reset()

                        // Create text file of the text selected
                        textContent = textContent.replace("_"," ")
                        //CreateTextFile(textContent, "output.txt")
                        cropCount +=1

                        if (cropCount >= images.length) {
                            img.src = "WIN.png"
                        }
                        else {
                            img.src  = images[cropCount]
                        }
                        

                    }


                    //startTag.parentNode.insertBefore(document.createTextNode("<div class='used'>"), startTag);
                    //endTag.parentNode.insertBefore(document.createTextNode("</div>"), endTag.nextSibling);
                });
            });

            document.addEventListener('keydown', function(event) {
    const key = event.key;
    if (key === "Backspace") {
        event.preventDefault();
        reset();
    }
});

            function reset() {
                startedSelect = false
                var selected = document.querySelectorAll(".startSelect");
                selected.forEach(elem => {
                    elem.classList.remove(("startSelect"));
                });
                var selected = document.querySelectorAll(".endSelect");
                selected.forEach(elem => {
                    elem.classList.remove(("endSelect"));
                });
            }function CreateTextFile(content, filename) {
                            var blob = new Blob([content], {
                                type: "text/plain;charset=utf-8",
                            });
                            const url = URL.createObjectURL(blob);

                            // Fake a client click on a download href
                            const a = document.createElement('a');
                            a.href = url;
                            a.download = filename;

                            document.body.appendChild(a);
                            a.click();

                            document.body.removeChild(a);
                            URL.revokeObjectURL(url);
                        }



        </script>
</body>